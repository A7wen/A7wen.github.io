<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„é˜…è¯»ä¸æ—¥å¸¸</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f7f4ef;
      --card: #ffffff;
      --text: #2f2f2f;
      --muted: #6b6b6b;
      --accent: #ffa94d;
      --accent-dark: #ff7a18;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "PingFang SC", "Segoe UI", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    header {
      background: linear-gradient(135deg, #fff1e6, #ffe7ba);
      padding: 3.5rem 1.5rem 5rem;
      text-align: center.
    }
    header h1 {
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      margin-bottom: 0.6rem;
    }
    header p {
      color: var(--muted);
      max-width: 520px;
      margin: 0 auto;
    }
    main {
      max-width: 1080px;
      margin: -3rem auto 4rem;
      padding: 0 1.2rem;
    }
    .card {
      background: var(--card);
      border-radius: 1.2rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.06);
    }
    .flex { display: flex; gap: 1.25rem; flex-wrap: wrap; }
    .flex > * { flex: 1 1 260px; }
    .hero-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.25rem; align-items: center; }
    .hero-info img { width: 100%; border-radius: 1.2rem; object-fit: cover; max-height: 280px; }

    .entry-form { display: flex; flex-direction: column; gap: 0.8rem; }
    .entry-form textarea {
      min-height: 100px; resize: vertical; padding: 0.8rem;
      border-radius: 0.8rem; border: 1px solid rgba(0, 0, 0, 0.15);
      font-family: inherit; font-size: 1rem;
    }
    .entry-form input {
      padding: 0.6rem 0.8rem;
      border-radius: 0.8rem;
      border: 1px solid rgba(0, 0, 0, 0.15);
      font-size: 1rem;
    }
    .mood-group { display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.95rem; }
    .mood-group label { display: flex; align-items: center; gap: 0.35rem; }
    .entry-form button {
      align-self: flex-start; padding: 0.6rem 1.6rem; border: none; border-radius: 999px;
      background: var(--accent); color: white; font-weight: 600; cursor: pointer; transition: background 0.2s ease;
    }
    .entry-form button:hover { background: var(--accent-dark); }
    .entry-form .hint { font-size: 0.9rem; color: var(--muted); margin: 0; }

    .emotions { gap: 1rem; flex-wrap: wrap; }
    .emotion-btn {
      flex: 1 1 150px; display: flex; flex-direction: column; align-items: center;
      gap: 0.5rem; padding: 1rem; border-radius: 0.9rem; border: 1px solid rgba(0, 0, 0, 0.08);
      cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; background: #fffdf8;
    }
    .emotion-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 20px rgba(0, 0, 0, 0.08); }
    .emotion-btn span { font-size: 2rem; }
    .emotion-btn small { color: var(--muted); }

    .list { list-style: none; padding: 0; margin: 0; display: grid; gap: 1rem; }
    .list li {
      padding: 1rem; border-radius: 0.9rem; background: #fff;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .list strong { display: block; font-size: 1.1rem; margin-bottom: 0.25rem; }
    .list p { margin: 0; color: var(--muted); }

    footer { text-align: center; padding: 2rem 1rem; color: var(--muted); font-size: 0.9rem; }
    @media (max-width: 640px) { header { padding: 2.5rem 1rem 4rem; } .card { padding: 1.25rem; } }
  </style>
</head>
<body>

  <header>
    <h1>æˆ‘çš„é˜…è¯»ä¸æ—¥å¸¸</h1>
    <p>åœ¨è¿™é‡Œå†™ä¸‹è¯»ä¹¦æ„Ÿæƒ³ã€ç”Ÿæ´»çƒ¦æ¼ä¸å°å°å¹¸ç¦ï¼Œè¿˜å¯ä»¥æ…¢æ…¢åŠ å…¥æœ‹å‹ä»¬çš„å£°éŸ³ã€‚</p>
  </header>

  <main>
    <section class="card hero-info">
      <div>
        <h2>ä»Šæ—¥ç¬”è®°</h2>
        <p>è®°å½•æ–‡å­—æˆ–å›¾ç‰‡é“¾æ¥ã€‚æäº¤åï¼Œè®°å½•ä¼šå­˜è¿›åå°æ•°æ®åº“ã€‚</p>
        <form id="entry-form" class="entry-form">
          <textarea name="text" placeholder="å†™ä¸‹ä»Šå¤©çš„æ–‡å­—..." required></textarea>
          <input name="image_url" type="url" placeholder="å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰" />
          <div class="mood-group">
            <label><input type="radio" name="mood" value="happy" checked> ğŸ˜Š å¼€å¿ƒ</label>
            <label><input type="radio" name="mood" value="trouble"> ğŸ—‘ï¸ çƒ¦æ¼</label>
            <label><input type="radio" name="mood" value="idea"> ğŸ’¡ çµæ„Ÿ</label>
          </div>
          <button type="submit">ä¿å­˜è®°å½•</button>
          <p class="hint">ç›®å‰ä¸æ”¯æŒç›´æ¥ä¸Šä¼ å›¾ç‰‡ï¼Œå¯å…ˆä¸Šä¼ åˆ°å›¾åºŠåç²˜è´´é“¾æ¥ã€‚</p>
        </form>
      </div>
      <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=800&q=80" alt="é˜…è¯»åœºæ™¯ç¤ºæ„å›¾" />
    </section>

    <section class="card">
      <h2>å¿ƒæƒ…å°æŒ‰é’®</h2>
      <div class="flex emotions">
        <button class="emotion-btn" data-type="trouble">
          <span>ğŸ—‘ï¸</span>
          <strong>æœ€è¿‘çƒ¦æ¼</strong>
          <small>ç‚¹å‡»æŸ¥çœ‹</small>
        </button>
        <button class="emotion-btn" data-type="happy">
          <span>ğŸ˜Š</span>
          <strong>æœ€è¿‘å¼€å¿ƒ</strong>
          <small>ç‚¹å‡»æŸ¥çœ‹</small>
        </button>
        <button class="emotion-btn" data-type="idea">
          <span>ğŸ’¡</span>
          <strong>å°çµæ„Ÿ</strong>
          <small>ç‚¹å‡»æŸ¥çœ‹</small>
        </button>
      </div>
    </section>

    <section class="card">
      <h2>ç²¾é€‰è®°å½•</h2>
      <div class="list" id="entries-list"></div>
    </section>

    <section class="card">
      <h2>æœ‹å‹ä»¬çš„ç•™è¨€ï¼ˆé¢„ç•™ï¼‰</h2>
      <p>æœªæ¥è¿™é‡Œå¯ä»¥æ¥å…¥çœŸå®çš„è¯„è®ºç³»ç»Ÿæˆ–æ•°æ®åº“ï¼Œå±•ç¤ºå…¶ä»–ç”¨æˆ·çš„ä½“éªŒ/ç•™è¨€ã€‚</p>
      <div class="upload-zone">
        <p>ç›®å‰ä¸ºå ä½åŒºï¼Œå¯æ›¿æ¢æˆâ€œå†™ç•™è¨€â€çš„è¡¨å•æˆ–â€œæŸ¥çœ‹è¯„è®ºâ€çš„åˆ—è¡¨ã€‚</p>
        <button onclick="alert('æœªæ¥åœ¨è¿™é‡Œå†™ä¸€æ®µç•™è¨€ï¼')">æˆ‘è¦ç•™è¨€</button>
      </div>
    </section>
  </main>

  <footer>
    <p>Â© 2025 ä¸ªäººç¬”è®°ç«™ Â· æœŸå¾…ä½ çš„ä¸‹ä¸€åˆ™å¿ƒæƒ…</p>
  </footer>

  <script>
    // ------------------ é…ç½® ------------------
    const API_BASE = "http://127.0.0.1:5000"; // æœ¬åœ°æµ‹è¯•ï¼›éƒ¨ç½²åæ¢æˆçº¿ä¸Š API
    let writeSecret = localStorage.getItem("WRITE_SECRET");
    if (!writeSecret) {
      writeSecret = prompt("è¯·è¾“å…¥å†™å…¥å¯†ç ï¼š", "my-secret-pass") || "";
      localStorage.setItem("WRITE_SECRET", writeSecret);
    }

    const entriesList = document.getElementById("entries-list");
    const entryForm = document.getElementById("entry-form");

    // ------------------ åŠ è½½è®°å½• ------------------
    async function loadEntries() {
      entriesList.innerHTML = "<p>åŠ è½½ä¸­...</p>";
      try {
        const res = await fetch(`${API_BASE}/entries`);
        const data = await res.json();
        if (!Array.isArray(data) || data.length === 0) {
          entriesList.innerHTML = "<p>è¿˜æ²¡æœ‰è®°å½•ï¼Œå¿«å†™ä¸€æ¡å§ï¼</p>";
          return;
        }
        entriesList.innerHTML = "";
        data.forEach((entry) => {
          const li = document.createElement("li");
          const time = new Date(entry.created_at).toLocaleString("zh-CN", { hour12: false });
          li.innerHTML = `
            <strong>${time} Â· ${entry.mood || "æœªçŸ¥å¿ƒæƒ…"}</strong>
            <p>${entry.text.replace(/\n/g, "<br/>")}</p>
            ${
              entry.image_url
                ? `<img src="${entry.image_url}" alt="å›¾ç‰‡" style="max-width: 100%; border-radius: 0.8rem;margin-top:0.5rem;" />`
                : ""
            }
          `;
          entriesList.appendChild(li);
        });
      } catch (err) {
        entriesList.innerHTML = "<p>åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚</p><small>" + err + "</small>";
      }
    }

    // ------------------ æäº¤è¡¨å• ------------------
    entryForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(entryForm);
      const text = formData.get("text").trim();
      const image_url = formData.get("image_url").trim();
      const mood = formData.get("mood") || "happy";

      if (!text) {
        alert("è¯·å…ˆå†™ç‚¹å†…å®¹å†æäº¤");
        return;
      }

      const submitBtn = entryForm.querySelector("button");
      submitBtn.disabled = true;
      submitBtn.textContent = "ä¿å­˜ä¸­...";

      try {
        const res = await fetch(`${API_BASE}/entries`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${writeSecret}`,
          },
          body: JSON.stringify({ text, imageUrl: image_url, mood }),
        });

        if (!res.ok) {
          const msg = await res.json().catch(() => ({}));
          throw new Error(msg.error || "ä¿å­˜å¤±è´¥");
        }

        entryForm.reset();
        await loadEntries();
        alert("ä¿å­˜æˆåŠŸï¼");
      } catch (err) {
        alert("ä¿å­˜å¤±è´¥ï¼š" + err.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "ä¿å­˜è®°å½•";
      }
    });

    // ------------------ å¿ƒæƒ…æŒ‰é’® ------------------
    document.querySelectorAll(".emotion-btn").forEach((btn) => {
      btn.addEventListener("click", async () => {
        const type = btn.dataset.type;
        try {
          const res = await fetch(`${API_BASE}/entries?mood=${type}`);
          const data = await res.json();
          if (!Array.isArray(data) || data.length === 0) {
            alert("è¿™ä¸€ç±»å¿ƒæƒ…è¿˜æ²¡æœ‰è®°å½•ï¼Œå¿«å»å†™ä¸€æ¡å§ï¼");
            return;
          }
          const preview = data
            .slice(0, 3)
            .map((entry) => `Â· ${entry.text}`)
            .join("\n\n");
          alert(preview);
        } catch (err) {
          alert("è·å–å¤±è´¥ï¼š" + err.message);
        }
      });
    });

    loadEntries();
  </script>
</body>
</html>
